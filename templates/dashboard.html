<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - GitHub Test Generator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/monaco-editor@0.41.0/min/vs/editor/editor.main.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/analytics.css') }}" rel="stylesheet">
</head>
<body class="dashboard-body">
    <!-- Background elements -->
    <div class="dashboard-bg">
        <div class="bg-orb orb-1"></div>
        <div class="bg-orb orb-2"></div>
        <div class="bg-orb orb-3"></div>
    </div>

    <!-- Top Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark glass-navbar fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fas fa-code-branch me-2"></i>
                GitHub Test Generator
            </a>
            
            <div class="navbar-nav ms-auto">
                <div class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle user-menu" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown">
                        <img src="{{ user.avatar_url or '/static/img/default-avatar.svg' }}" alt="Avatar" class="user-avatar me-2">
                        {{ user.username }}
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end glass-dropdown">
                        <!-- <li><a class="dropdown-item" href="#"><i class="fas fa-user me-2"></i>Profile</a></li>
                        <li><a class="dropdown-item" href="#"><i class="fas fa-cog me-2"></i>Settings</a></li> -->
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="{{ url_for('logout') }}"><i class="fas fa-sign-out-alt me-2"></i>Logout</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid dashboard-container">
        <div class="row h-100">
            <!-- Sidebar -->
            <div class="col-lg-2 sidebar-col">
                <div class="sidebar glass-sidebar">
                    <div class="sidebar-content">
                        <ul class="nav nav-pills flex-column">
                            <li class="nav-item">
                                <a class="nav-link active" data-tab="repository">
                                    <i class="fas fa-folder-open"></i>
                                    <span>Repository</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-tab="generator">
                                    <i class="fas fa-magic"></i>
                                    <span>Generator</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-tab="test-cases">
                                    <i class="fas fa-flask"></i>
                                    <span>Test Cases</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-tab="analytics">
                                    <i class="fas fa-chart-bar"></i>
                                    <span>Analytics</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-tab="pull-requests">
                                    <i class="fas fa-code-branch"></i>
                                    <span>Pull Requests</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Main Content Area -->
            <div class="col-lg-10 main-content-col">
                <div class="main-content">
                    
                    <!-- Repository Tab -->
                    <div class="tab-content active" id="repository-tab">
                        <div class="tab-header">
                            <h2><i class="fas fa-folder-open me-2"></i>Repositories</h2>
                            <p>Browse and manage your GitHub repositories</p>
                        </div>
                        
                        <div class="content-grid">
                            <!-- Repository List -->
                            <div class="repository-grid" id="repository-list">
                                <div class="loading-skeleton">
                                    <div class="skeleton-card"></div>
                                    <div class="skeleton-card"></div>
                                    <div class="skeleton-card"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Generator Tab -->
                    <div class="tab-content" id="generator-tab">
                        <div class="generator-compact-layout">
                            <!-- Top Section: Files Selection and Options -->
                            <div class="generator-top-section">
                                <div class="row g-3">
                                    <div class="col-md-8">
                                        <div class="glass-card compact-card">
                                            <div class="card-header compact-header">
                                                <h5><i class="fas fa-file-code me-2"></i>Selected Files</h5>
                                            </div>
                                            <div class="card-body compact-body">
                                                <div id="selected-files-list" class="selected-files compact-files">
                                                    <div class="empty-state compact-empty">
                                                        <i class="fas fa-file-code"></i>
                                                        <span>No files selected - Choose from Repository tab</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-4">
                                        <div class="glass-card compact-card">
                                            <div class="card-header compact-header">
                                                <h5><i class="fas fa-cog me-2"></i>Options</h5>
                                            </div>
                                            <div class="card-body compact-body">
                                                <!-- Technology Select -->
                                                <div class="mb-2">
                                                    <label class="form-label compact-label">Technology</label>
                                                    <select class="form-select form-select-sm" id="technology-select">
                                                        <option value="python">Python</option>
                                                        <option value="javascript">JavaScript</option>
                                                        <option value="java">Java</option>
                                                        <option value="csharp">C#</option>
                                                        <option value="go">Go</option>
                                                        <option value="rust">Rust</option>
                                                    </select>
                                                </div>
                                                
                                                <!-- Edge Cases Dropdown -->
                                                <div class="mb-2">
                                                    <label class="form-label compact-label">Edge Cases</label>
                                                    <div class="dropdown">
                                                        <button class="btn btn-outline-secondary btn-sm dropdown-toggle w-100 text-start" 
                                                                type="button" id="edgeCasesDropdown" data-bs-toggle="dropdown">
                                                            <i class="fas fa-check-square me-2"></i>Select Options
                                                        </button>
                                                        <ul class="dropdown-menu w-100 edge-cases-dropdown">
                                                            <li>
                                                                <div class="form-check dropdown-item">
                                                                    <input class="form-check-input" type="checkbox" value="null-values" id="edge-null">
                                                                    <label class="form-check-label" for="edge-null">Null Values</label>
                                                                </div>
                                                            </li>
                                                            <li>
                                                                <div class="form-check dropdown-item">
                                                                    <input class="form-check-input" type="checkbox" value="empty-strings" id="edge-empty">
                                                                    <label class="form-check-label" for="edge-empty">Empty Strings</label>
                                                                </div>
                                                            </li>
                                                            <li>
                                                                <div class="form-check dropdown-item">
                                                                    <input class="form-check-input" type="checkbox" value="boundary-values" id="edge-boundary">
                                                                    <label class="form-check-label" for="edge-boundary">Boundary Values</label>
                                                                </div>
                                                            </li>
                                                            <li>
                                                                <div class="form-check dropdown-item">
                                                                    <input class="form-check-input" type="checkbox" value="error-conditions" id="edge-error">
                                                                    <label class="form-check-label" for="edge-error">Error Conditions</label>
                                                                </div>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                
                                                <!-- Generate Button -->
                                                <button class="btn btn-primary btn-sm w-100" id="generate-tests-btn" disabled>
                                                    <i class="fas fa-magic me-2"></i>Generate Tests
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Bottom Section: Generated Test Cases -->
                            <div class="generator-bottom-section">
                                <div class="glass-card full-height-card">
                                    <div class="card-header compact-header d-flex justify-content-between align-items-center">
                                        <h5><i class="fas fa-code me-2"></i>Generated Test Cases</h5>
                                        <div class="test-actions d-flex gap-2">
                                            <button class="btn btn-xs btn-outline-secondary" id="copy-tests-btn" disabled title="Copy to Clipboard">
                                                <i class="fas fa-copy"></i>
                                            </button>
                                            <button class="btn btn-xs btn-outline-secondary" id="maximize-editor-btn" disabled title="Maximize Editor">
                                                <i class="fas fa-expand"></i>
                                            </button>
                                            <button class="btn btn-sm btn-outline-primary" id="commit-tests-btn" disabled>
                                                <i class="fas fa-git-alt me-1"></i>Commit & Push
                                            </button>
                                        </div>
                                    </div>
                                    <div class="card-body p-0">
                                        <div id="test-editor" class="monaco-editor-compact"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Test Cases Tab -->
                    <div class="tab-content" id="test-cases-tab">
                        <div class="tab-header">
                            <h2><i class="fas fa-flask me-2"></i>Test Cases History</h2>
                            <p>View and manage your generated test cases</p>
                        </div>
                        
                        <div class="test-cases-grid" id="test-cases-list">
                            <div class="loading-skeleton">
                                <div class="skeleton-item"></div>
                                <div class="skeleton-item"></div>
                                <div class="skeleton-item"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Analytics Tab -->
                    <div class="tab-content compact-analytics" id="analytics-tab">
                        <div class="tab-header d-flex justify-content-between align-items-center flex-wrap gap-2">
                            <div>
                                <h2><i class="fas fa-chart-bar me-2"></i>Analytics Dashboard</h2>
                                <p class="mb-0">Insights into your testing workflow</p>
                            </div>
                            <div class="tech-tags" id="tech-tags-container"></div>
                        </div>
                        
                        <div class="row">
                            <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                                <div class="glass-card stat-card">
                                    <div class="stat-icon">
                                        <i class="fas fa-file-code"></i>
                                    </div>
                                    <div class="stat-content">
                                        <h3 id="total-files-stat">0</h3>
                                        <p>Files Generated</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                                <div class="glass-card stat-card">
                                    <div class="stat-icon">
                                        <i class="fas fa-folder"></i>
                                    </div>
                                    <div class="stat-content">
                                        <h3 id="total-repos-stat">0</h3>
                                        <p>Repositories</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                                <div class="glass-card stat-card">
                                    <div class="stat-icon">
                                        <i class="fas fa-list-check"></i>
                                    </div>
                                    <div class="stat-content">
                                        <h3 id="total-testcases-stat">0</h3>
                                        <p>Test Cases</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                                <div class="glass-card stat-card">
                                    <div class="stat-icon">
                                        <i class="fas fa-search"></i>
                                    </div>
                                    <div class="stat-content">
                                        <h3 id="total-analyses-stat">0</h3>
                                        <p>Code Analyses</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                                <div class="glass-card stat-card">
                                    <div class="stat-icon">
                                        <i class="fas fa-star"></i>
                                    </div>
                                    <div class="stat-content">
                                        <h3 id="quality-score-stat">0</h3>
                                        <p>Avg Quality Score</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                                <div class="glass-card stat-card">
                                    <div class="stat-icon">
                                        <i class="fas fa-chart-line"></i>
                                    </div>
                                    <div class="stat-content">
                                        <h3 id="productivity-score-stat">0</h3>
                                        <p>Productivity Score</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row align-items-stretch">
                            <div class="col-lg-6 mb-4">
                                <div class="glass-card equal-card h-100">
                                    <div class="card-header">
                                        <h4>Activity Trends (Last 30 Days)</h4>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="activity-chart"></canvas>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-lg-6 mb-4">
                                <div class="glass-card equal-card h-100">
                                    <div class="card-header">
                                        <h4>Security Metrics</h4>
                                    </div>
                                    <div class="card-body">
                                        <div class="security-metrics">
                                            <div class="metric-item">
                                                <span class="metric-label">Critical Vulnerabilities</span>
                                                <span class="metric-value text-danger" id="critical-vulns-stat">0</span>
                                            </div>
                                            <div class="metric-item">
                                                <span class="metric-label">High Vulnerabilities</span>
                                                <span class="metric-value text-warning" id="high-vulns-stat">0</span>
                                            </div>
                                            <div class="metric-item">
                                                <span class="metric-label">Medium Vulnerabilities</span>
                                                <span class="metric-value text-info" id="medium-vulns-stat">0</span>
                                            </div>
                                            <div class="metric-item">
                                                <span class="metric-label">Low Vulnerabilities</span>
                                                <span class="metric-value text-success" id="low-vulns-stat">0</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row align-items-stretch">
                            <div class="col-lg-6 mb-4">
                                <div class="glass-card equal-card h-100">
                                    <div class="card-header">
                                        <h4>Quality Trends</h4>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="quality-chart"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 mb-4">
                                <div class="glass-card report-card equal-card h-100">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <h4>Generate AI-Powered Report</h4>
                                        <button class="btn btn-primary" id="generate-report-btn">
                                            <i class="fas fa-download me-1"></i>Generate Report
                                        </button>
                                    </div>
                                    <div class="card-body">
                                        <p>Generate a comprehensive AI-powered HTML report with detailed insights and recommendations.</p>
                                        <div class="report-options">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="include-charts" checked>
                                                <label class="form-check-label" for="include-charts">Include Charts</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="include-details" checked>
                                                <label class="form-check-label" for="include-details">Include AI Insights</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Pull Requests Tab -->
                    <div class="tab-content" id="pull-requests-tab">
                        <div class="tab-header">
                            <h2><i class="fas fa-code-branch me-2"></i>Pull Requests</h2>
                            <p>Monitor pull requests across your repositories</p>
                        </div>
                        
                        <div class="pull-requests-container" id="pull-requests-list">
                            <div class="loading-skeleton">
                                <div class="skeleton-pr"></div>
                                <div class="skeleton-pr"></div>
                                <div class="skeleton-pr"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- File Browser Modal -->
    <div class="modal fade" id="fileBrowserModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content" style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%); border: 1px solid rgba(255,255,255,0.1); border-radius: 15px; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
                <div class="modal-header" style="border-bottom: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05);">
                    <h5 class="modal-title text-light" style="font-weight: 600; display: flex; align-items: center;">
                        <i class="fas fa-folder-open me-2" style="color: #00d4ff;"></i>
                        <span style="background: linear-gradient(45deg, #00d4ff, #1a73e8); -webkit-background-clip: text; -webkit-text-fill-color: transparent;" id="modal-repo-name">Repository Browser</span>
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" style="filter: invert(1); opacity: 0.8;"></button>
                </div>
                <div class="modal-body" style="background: rgba(255,255,255,0.02); padding: 1.5rem;">
                    <div class="row g-3">
                        <div class="col-lg-6">
                            <div class="file-tree-container" style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 1rem;">
                                <div class="file-tree-header" style="border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 0.75rem; margin-bottom: 1rem; display: flex; justify-content: between; align-items: center;">
                                    <h6 class="text-light mb-0" style="font-weight: 500; display: flex; align-items: center;">
                                        <i class="fas fa-folder-tree me-2" style="color: #00d4ff;"></i>Files & Folders
                                    </h6>
                                    <div class="tree-actions d-flex gap-2">
                                        <button class="btn btn-xs" id="select-all-btn" style="background: rgba(16, 185, 129, 0.2); border: 1px solid #10b981; color: #10b981; border-radius: 6px; font-size: 0.7em; padding: 4px 8px;">
                                            <i class="fas fa-check-double me-1"></i>All
                                        </button>
                                        <button class="btn btn-xs" id="deselect-all-btn" style="background: rgba(239, 68, 68, 0.2); border: 1px solid #ef4444; color: #ef4444; border-radius: 6px; font-size: 0.7em; padding: 4px 8px;">
                                            <i class="fas fa-times me-1"></i>None
                                        </button>
                                    </div>
                                </div>
                                <div id="file-tree" class="file-tree" style="background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; padding: 12px; color: #e2e8f0; max-height: 400px; overflow-y: auto; font-family: 'Monaco', 'Menlo', 'Consolas', monospace;"></div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="file-preview-container" style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 1rem;">
                                <div class="file-preview-header" style="border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 0.75rem; margin-bottom: 1rem; display: flex; justify-content: between; align-items: center;">
                                    <h6 class="text-light mb-0" style="font-weight: 500; display: flex; align-items: center;">
                                        <i class="fas fa-eye me-2" style="color: #00d4ff;"></i>File Preview
                                    </h6>
                                    <div class="file-actions d-flex gap-2">
                                        <button class="btn btn-xs" id="refactor-btn" disabled style="background: rgba(245, 158, 11, 0.2); border: 1px solid #f59e0b; color: #f59e0b; border-radius: 6px; font-size: 0.7em; padding: 4px 8px;">
                                            <i class="fas fa-wrench me-1"></i>Refactor
                                        </button>
                                        <button class="btn btn-xs" id="vulnerability-btn" disabled style="background: rgba(239, 68, 68, 0.2); border: 1px solid #ef4444; color: #ef4444; border-radius: 6px; font-size: 0.7em; padding: 4px 8px;">
                                            <i class="fas fa-shield-alt me-1"></i>Security
                                        </button>
                                    </div>
                                </div>
                                <div id="file-preview" class="file-preview" style="background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: #e2e8f0; max-height: 400px; overflow-y: auto; font-family: 'Monaco', 'Menlo', 'Consolas', monospace;">
                                    <div class="preview-placeholder" style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 200px; color: rgba(255,255,255,0.4);">
                                        <i class="fas fa-file-code fa-3x mb-3"></i>
                                        <p class="mb-0" style="font-weight: 500;">Select a file to preview</p>
                                        <small style="opacity: 0.7;">Choose any file from the tree to see its contents</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer" style="border-top: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.02); padding: 1.5rem; display: flex; justify-content: space-between; align-items: center;">
                    <div class="selected-count" style="background: rgba(0, 212, 255, 0.1); border: 1px solid rgba(0, 212, 255, 0.3); padding: 8px 12px; border-radius: 8px; display: flex; align-items: center;">
                        <i class="fas fa-check-circle me-2" style="color: #00d4ff;"></i>
                        <span id="selected-files-count" class="text-light" style="font-weight: 500;">0 files selected</span>
                    </div>
                    <div class="d-flex gap-2">
                        <button type="button" class="btn" data-bs-dismiss="modal" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #e2e8f0; border-radius: 8px; padding: 8px 16px;">
                            <i class="fas fa-times me-2"></i>Close
                        </button>
                        <button type="button" class="btn" id="add-to-generator-btn" disabled style="background: linear-gradient(45deg, #10b981, #059669); border: none; color: white; border-radius: 8px; padding: 8px 16px; font-weight: 500; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);">
                            <i class="fas fa-plus me-2"></i>Add to Generator
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Analysis Result Modal -->
    <div class="modal fade" id="analysisModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content glass-modal">
                <div class="modal-header">
                    <h5 class="modal-title" id="analysis-modal-title">Code Analysis</h5>
                    <button type="button" class="btn-close btn-close-red" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="analysis-result" class="analysis-content"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Maximize Editor Modal -->
    <div class="modal fade" id="maximizeEditorModal" tabindex="-1">
        <div class="modal-dialog modal-fullscreen">
            <div class="modal-content glass-modal">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-code me-2"></i>Generated Test Cases - Fullscreen
                    </h5>
                    <div class="modal-actions d-flex gap-2">
                        <button class="btn btn-sm btn-outline-secondary" id="copy-tests-maximized-btn" title="Copy to Clipboard">
                            <i class="fas fa-copy me-1"></i>Copy
                        </button>
                        <button type="button" class="btn-close btn-close-red" data-bs-dismiss="modal"></button>
                    </div>
                </div>
                <div class="modal-body p-0">
                    <div id="test-editor-maximized" class="monaco-editor-maximized"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.41.0/min/vs/loader.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>
